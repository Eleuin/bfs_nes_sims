	NEW BUGS

- sometimes, at the beginning of the Practice mode, when game message window appears at the same time as scroller message on the screen, the R left at the left-top corner. can't reproduce it every time. because of that I'm not completely shure it is new bug, but not the something old.

	WHAT DONE

- Removal of garbage data and commented all unreferenced data and code for further possible usage, if any.
- Cleanup some portions of the code, minor optimizations on size.
- Macrofication of the code for much more readable listing.
- Commented as much as possible code and data which i clearly understand what they do or sometimes some thoughts about how they write this code.
- Optimized redundant or duplicated code chunks, similar routines merged and used as system routines. Overall reducing of the code more than 4Kb without any changes to the game's logic (except maybe timings and sometimes RND as a result of that).
- Re-enabled unsed sound effect, can be heard with var $00F1 set to value $80. Still have no idea where it should be used.
- Re-enabled 4-frame animation for Helicopter. Have no idea wether it was removed on purpose or by accident. 4-frame looks much more blinking, maybe epilepcy issues?
- Fixed Scenario Screen potential crash, when all scenarios unlocked. Also fixed redundant CPU cycles due to RAM address mistake there.
- Fixed critical bug with ppu queue overflow in Name Entry Screens.
- Attributes of the pressed buttons on the Name Entry Screens are now not inverted while pushed. However, they may invert it on purpose, but this looks odd actually. The evidence it may be done on purpose that non-sprite push button ("CL") animation uses attr switch the same way as sprites does.
- Restored unfinished Ship object using existing movement logic with some corrections to work properly. Added random turn logic to be similar to the SNES version. Some wrong code was removed, the rest of the missing code for selecting the deploy position and deploying the object was added.

	CODES

- At any time during the game, press A + B + Select + Start on controller 1 to Soft Reset.
- At the title screen, press A + B + Up + Left on controller 2 to clear SRAM data.
- During the game in any mode, at any message window (disasters, hints, information), press at the same time A + B on controller 2 and all D-Pad buttons Up + Down + Left + Right using both controllers in any combination (Up + Left on controller 1 and Down + Right on controller 2, etc.). Release all buttons. Now, hold one of the D-Pad buttons on both controllers at the same time (for example hold Right on controller 1 and Right on controller 2, etc.), while holding these buttons, press once any other D-Pad button on controller 1. Exit the message window either with A or B on controller 1. A message "I AM GOD   I WISH YOU HAPPY" will scroll at the game' HUD instead of regular alert messages and a debug mode is toggles ON. Do the same operations one more time to toggle this mode OFF with another message "I AM GOD   DEBUG OFF". The debug mode makes some changes to the gameplay:
	- All constructions cost no money. However, the budget income/outcome still work.
	- Be able to place any number of buildings at any position without collision check (causes a lot of glitches if heavily obused).
- You might not know this but any of 5 small menu windows with the game settings or info (SPEED, OPTIONS, DISASTERS, WINDOWS, GAME) can be moved across the screen. To do this, put cursor to the upper-left corner of the window, hold A, then move it with D-Pad buttons. Each window will memorize its last position for the rest of the current game. However, the windows positions can't be saved and lost when exit from the game.

	UNFINISHED

- There are 6 regular scenarios available from the beginning. When you beat 6 regular scenarios, two additional scenarios will be available: "Las Vegas UFO" and "Freedom".
	- Both have no briefing texts and window headers, only blank windows.
	- Scenario "Freedom" have proper map data but have no any proper scenario parameters to load. So all flags, money amount, game settings are be semi-random at start. CANT BE PATCHED.
	- Scenario "Las Vegas UFO" should have an UFO object as a disaster judging from its name. The CHR data contains two frames of the large UFO with a tractor beam. However, there no any other mentions in game messages nor game code for such type of disasters. It is just not implemented at all.
- There are 5 name buffers inside
	- First is your town name, default name "SIMCITY".
	- Second is what you enter as a favorite word, used as a sister town name during the game in New Town mode, if not entered, used the default name. In practice and scenario modes is blank, so message about  sistership of towns will lack the name of the City at all.
	- Third name used as bank name inside the message resourses, but never initialized with any value, always blank, the same as with blank sister town name.
	- Two more are unused completely.
- One of the SE effects unreferenced and there is not known where it should be used. Use GG AKOXTGAA+YSXZPKAP then write $08 to $00F1 address in RAM to hear it.
- There are total 25 messages for scroller line at the game's HUD. Only 16 are handled by the game engine.
	- Used from 0 to F except B ("Blackouts"), also 18 ("Heavy traffic report") in a custom handler. The rest of messages aren't used at all.
	- Most of them are about disasters and crashes and duplicates the ingame alert messages.
	- Some events doesn't appear in this version ("Helicopter crash", "Shipwreck reported", "Train crash", "Hi unemployment rate", "City gone broke", "Explosion", "Brownouts"). See the full list of events in the table below.
- There are currently 3 different kind of vehicles visible on the map: a Heli, an Airplain and a Train (its indexes correspondingly 0, 1 and 3). The missing vehicle object with index 2 has most of its code programmed. Judging from the unused CHR data tiles this should be a Ship. The map overview mode displaying all vehicles as a small letters. For used vehicles has accordingly "H" (Heli), "A" (Airplane) and "R" (tRain). Unused vehicle should be displayed as "S" (Ship) correspondingly.
- There is a unfinished leftover code from an old attempt to calculate the starting position for unused Ship vehicle. It executes every time when the game engine counts sea ports and trying to search for a specific tile in the map buffer ($FE). After all it just set the current sea port position as a starting position of the ship, which never used because there is no Ship deploy code in the ROM at all.
	- Tile $FE never used and seems just a copy of open water tile ($BD), so this code does not find anything.
	- The search loop stop conditions uses the buffer size instead of end of buffer offset, so this loop should've search through all CPU space, wrap to RAM and ends something in RAM MIRROR area, but can stop earlier, because there are some $FE bytes in the PRG code.
	- Both takes a lot of CPU cycles, but does nothing after all. Fix it with GG to skip uneeded work SUEXUEVN+TNOXUATP.
	- It may be speculated, that they planned to do some kind of "Sea routes" for ship, to make him sail on fixed areas. However, this likely just an old redefined tile for open sea on map, and so this Ship code leftovers may be dropped at the very early developement stage. Probably they just wanted to know if there any water on the map exists.
- The unused Ship vehicle has two sets of sprites for years before and after 1950. Sprites 5 and 6 of the first set are broken, as well as sprite 3 of the second set.
- In the data for in-game menus there are two unused "YES/NO" windows: "DO YOU QUIT PLAYING WITHOUT SAVING?" and "DO YOU WANT TO START NEW CITY?". Both unused. In all cases except "LOAD GAME" the common "SAVE GAME" menu used instead.
- The data used for Graphs screen in the current version calculated very briefly, and code looks like a mess sometimes. All values for this screen are fixed point values between -2 and 2, so the graphs display only a small columns for all parameters except crime rate, which is calculated differently. Also code lacks proper scaling of parameters although the max values for RCI data are calculated and stored. So we may presume the scaling has been planned.
- Auto Budget setting in Options does nothing. Budget is planned and trimmed automatically always, and the Budget screen can't be disabled or skipped during the game.
- Helicopter spprites contains a 4 frame animations of the flight for every movement direction. However, only two of four used for some reason.

	BUGS

- The extra scenarios selecting screen code trying to draw "CLEAR" icons on unlocked scenarios, but there aren't proper icon position data for that, so if you manage to beat at least one of them, the scenarios select screen will glitch. If you beat both, game will hang. FIX PATCH: 0x0020F9: D0 27 EA EA EA EA EA EA EA EA EA EA EA EA EA EA EA
- Use the turbo button A on name input screens to glitch the screen because of ppu queue buffer overflow due to lack of proper sync. CANNOT BE PATCHED
- First briefing messages has a couple spelling errors and incorrect placeholders. CANNOT BE PATCHED
- There is an unused disabled branch in Practice mode to check if you go well or bad during this game. This branch should check your town population after year 1906 (should be 30000), then send a message if you did it well or you need more practice. For some reason they decided to disable it. Or just make bug in a selection logic. FIX GG: GESLGPTZ.
- There is non-critical bug in present items free slot search routine. In case you have no free slots, it will run for 256 loops of dummy cycle instead of just exit. No side effects in this except missed CPU cycles.
- Some events haven't appear automatically when you get it (see table below) due to some sort of hardly visible bug with indexes comparisons. In case you get this bug, you need to go open Hints menu manually in order to obtain a Special item. Most of events works just fine, there only 2 of them which are affected. With this bug you may loose your current present if any other message appear before you go to the Hint screen.
- (*1) Byte at $6CC RAM address is a temporary variable used in many places of the program to store intermediate calc data. However, most of the time it has a value of POWER STATIONS counter, which is calculated every game iteration. This var used exactly as a POWER STATIONS count for the warning scrolled messages tests. Although it used for calculations at the end of the fiscal year and has a semi-random value immediately after the year budget screen is closed, this has no really significant effect to the game and message triggering except the case this semi random value gets ZERO, which is rarely possible.
- This bug looks bad but appears to be not so critical. At BANKB:$A8D9 there is a calculations which fetch power grid buffer data, then test if the particular tile is powered up or not. The opcode at BANKB:$A90E (AND $A3B6,X) refers to the bitmasks table from BANKA, but in BANKB it refers to the portion of the game's code so masking will get the wrong result most of the time, reporting are powered while they are not or vice versa. Seems they overlooked this when moving the code around. To fix in in current ROM. FIX GG: KIEXNPVU + OLOZEPUX.
- Also, there is a counter of all map tiles that were tested and has power, some kind of "power consumption" level. But it never used. Instead, there is only one flag used in overal calculations if tile is powered or not. Seems we have bug in some calcs out there, which may use wrong values instead of proper ones.
- Sound is cracking sometimes in two channels. FIX GG: EPXXYZNP (for square channel only, a courtesy of Chris Covell).
- When airplane crashes, it's damaging one particular tile on the map with enabling "GOTO" alert button. However, due to copy-paste bug, the coordinates of "GOTO" are wrong and not points to the crash site. FIX GG: KEEAGEVE.
- Pollution area zone calculated as a sum of weights of the tiles for every 4x4 map area. Weights are follow: developer I area +2 for a tile (+8 for 2x2 building), coal power station +3 for a tile (+36 for 3x3 building), flooded ground +15 for a tile, the rest gives 0. Looks odd, right? Why flooded ground counts as max pollution instead of radiation waste ground? Looks like a bug to me.
- Tere is a var $67D, which never written by any code, but read sometimes and used in calcs. It used at $A:$AB69, where the calc results stored in vars $6D6-6DB. May it be a mistakenly swapped numbers 67D-6D7 for a proper var? Then it should be a high nibble of traffic level value. However, it is used also at $A:$A9F7 in an overall city assessed value, added to police stations count and weighted then summed in overal value. Both places should seemingly use a different variables, both seems incorrect by now.
- The clear routine clears only the lower nibble of Assessed City Value not touching the high ones and then immediately clears the _annual_score_change var which is temporary recalculated var too, but sit near the assessed value ram address. Wether they missed two more bytes to be cleared, or clear a vrong vars instead.
- Assessed city calculation routine (_city_assessed_value_recalc) has a major calc value mistake: 6 out of 9 parameters has wrong weight multipliers, basicly they swapped hi and low nibble of the 16-bit values. So instead of weight of hospitals $0190 (decimal 400) we have $9001 (decimal 36865) and so on.

	MISC

- The game engine consists of two main separate mostly independent parts. First is an interface and display control part. It handles all inputs, menus, drawing graphics, screen objects/sprites manager, disasters manipulation. The second is a city control and statistics collector part. It does all city specific calcs on population, industry, energy, pollution and traffic. Does statis and charts for info displays, etc... Both parts constantly does its own work in loop, never stop. The most interesting part, they work like some kind of threads in parallel. The threads manager in NMI handler switches between two process through stack manipulation, so both work some kind in parallel. The interface thread has a priority on a man activity. If you press any button, it will take control instantly, and city calcs will be halted. In other way, the city calc part can raise a flags to forbit some portions of the interface code to read the data it calculating now. I have not seen such engine in any game before. Usually, threading methods used in a scripted engines. This is the first game I've seen that do it on the native code. Basicly, this method can be used for multi-threading operation systems for NES, the problem is just in a very small stack.
- For some reason until you get the City Status and build a Bank, you have only 3 free Special events slots. The rest of the game you'll have 4 slots. However, if all your slots are full, any pending event will wait until any empty slot appears.
- The word "ISHI" is used as a RAM signature for Soft/Hard Reset test.
- All music tracks are used in the game. Most of tracks used to highlight the town population value. some tracks are "paired" and consists of two conjuncted parts. An intro and looped main track (01-02 title, 08-10 practice, 48-50, 60-40 information).
- (*2) There is an automatically spawned helicopter for observing the road traffic. It floats randomly and every iteration its coordinates tested against the traffic map. If helicopter flying over the traffic location with density above 9 it will report about it with DPCM speech and a scroller message. Judging from the message index (18th, the last one in the list) and the fact that all previous messages aren't used at all, we may presume that this heli message and sound were added to the game at the late stage of developement with a quick and lazy method, avoiding the regular message system and called from the top of the system loop.
- Sound engine tables the same as in Nintendo games: Baloon Fight, Duck Hunt, Gumshoe, Gyromite, Hogan's Alley, Stack Up, Wrecking Crew. Definitely, the sound engine was based on the engines for these games. All has similar way to play SE by setting flag bits and so on.
- Power consumption calculated as: TOTAL_POWER = COAL*700 + NUCLEAR*2000 pts. Every single powerable building tile and every electric wire consume 1 pt. Due to recursive method of collecting the network data, there will be extra power points consumed according to placement and location of adjascent buildings. So the same amount of building may consume more or less power just because of placement and grouping of the buildings.

	APPEND. A - SPECIAL EVENTS

	EVENT						REQUIREMENTS			RESULTS					REPEATS				MESSAGE APPEAR
01	Becomes a Town 				2000 population			Town History record		once per game		yes
02	Becomes a City				10000 population		Town History record,	once per game		yes
														White House Building
03	Becomes a Capital			50000 population		Town History record		once per game		yes
04	Becomes a Metropolis		100000 population		Town History record		once per game		yes
05	Becomes a Megapolis			500000 population		Town History record		once per game		yes
06	Traffic is bumper to bumper traffic level 7			-						every recalculation	yes
07	Commuters are grid-locket	traffic level 2			- 						every recalculation	yes
08	Crime rate is much too high	crime level 7			-						every recalculation	yes
0B	Bank wants to build office	5 years after built		Bank Special Building	once per game		yes
								White House Building
0C	City wants relationship		150000 population		-						once per game		yes
0D	Open amusement park			120000 population		Amusement Park Building	once per game		yes
0E	Open a Zoo					250000 population		Zoo Building			once per game		yes
0F	Open a Casino				200000 population		Casino Building			once per game		yes
10	Build an extra land			2 Sea Ports				Extra Land Item			once per game		no (bug)
11	New Police Station			10 Police Stations		New Police Building		once per game		yes
12	New FireStation				10 Police Stations		New Fire Building		once per game		yes
13	10th anniversary monument	Fidex 1910 year			10th Monument			once per game		yes
14	100th anniversary monument	Fixed 2000 year			100th Monument			once per game		yes
15	Holding World Expo			Fixed 1950 year			-						once per game		yes
16	Erect Expo monument			1 year after Expo		Expo Monument			once per game		yes
17	Statue of Liberty present	10 years after City		Statue of Liberty		once per game		yes
								relationship
18	Build a Library				70000 population		Library Building		once per game		no (bug)
19	Parks expand				200 park squares		Parks Building			once per game		yes
1A	Railroad Station			150 rail squares		Railroad Station		once per game		yes

	APPEND B. SCROLL MESSAGES

	MESSAGE										REQUIREMENTS				FORCED		NOTES
00	MORE RESIDENTIAL ZONES NEEDED				R<(R+C+I)/4					no			-
01	MORE COMMERCIAL ZONES NEEDED				C<(R+C+I)/8					no			-
02	MORE INDUSTRIAL ZONES NEEDED				I<(R+C+I)/8					no			-
03	MORE ROADS REQUIRED							(R+C+I)>=10, (R+C+I)>ROADS	no			-
04	INADEQUATE RAIL SYSTEM						(R+C+I)>=50, (R+C+I)>RAILS	no			-
05	BUILD A POWER PLANT							(R+C+I)>10, POWER=0			no			*1 see BUGS sect.
06	RESIDENTS DEMAND A STADIUM					RLEVEL>=500fp, STADIUM=0	yes			-
07	INDUSTRY REQUIRES A SEA PORT				ILEVEL>=100fp, SEAPORT=0	yes			-
08	COMMERCE REQUIRES AN AIRPORT				VLEVEL>=150fp, AIRPORT=0	yes			-
09	CITIZENS DEMAND A FIRE DEPARTMENT			W$672>=60, SPOLICE=0		no			-
0A	CITIZENS DEMAND A POLICE DEPARTMENT			W$672>=60, SFIRE=0			no			-
0B	BLACKOUTS REPORTED  CHECK POWER MAP			-unused-					-			-
0C	CITIZENS UPSET  THE TAX RATE IS TOO HIGH	TAX_RATE>=12				no			-
0D	ROADS DETERIORATING  DUE TO LACK OF FUNDS	RFUND_RATE<22, ROADS>=30	no			-
0E	FIRE DEPARTMENTS NEED FUNDING				FFUND_RATE<11, W$672>=20	no			-
0F	POLICE DEPARTMENTS NEED FUNDING				PFUND_RATE<11, W$672>=20	no			-
10	A PLANE HAS CRASHED							-unused-					-			-
11	SHIPWRECK REPORTED							-unused-					-			-
12	A TRAIN CRASHED								-unused-					-			-
13	A HELICOPTER CRASHED						-unused-					-			-
14	UNEMPLOYMENT RATE IS HIGH					-unused-					-			-
15	YOUR CITY HAS GONE BROKE					-unused-					-			-
16	EXPLOSION DETECTED							-unused-					-			-
17	BROWNOUTS  BUILD ANOTHER POWER PLANT		-unused-					-			-
18	HEAVY TRAFFIC REPORTED						TRAFFIC>=10 under HELI		yes			*2 see MISC sect.

	APPEND C. MAP TILE INDEXES

		BUILDING					FLAGS	FLAG BITS
00-18	regular R area				CA		11001010
19		hospital					CA		11001010
1A		school						CA		11001010
1B-1F	-							-		-
20-38	C area						CA		11001010
39-3F	-							-		-
40-48	I area						CA		11001010
49-4F	-							-		-
50		police station				CA		11001010
51		fire station				CA		11001010
52-5F	-							-		-
60		coal power station			CA		11001010
61		nuclear power station		CA		11001010
62		sea port					CA		11001010
63		stadium						CA		11001010
64		air port					CA		11001010
65-6F	-							-		-
70		bank						CE		11001110
71		amusement park				CE		11001110
72		zoo							CE		11001110
73		casino						CE		11001110
74		reclaimed water ground		CE		11001110	*replaced with 90
75		new police station			CE		11001110
76		new fire station			CE		11001110
77		10th monument				CE		11001110
78		100th monument				CE		11001110
79		expo monument				CE		11001110
7A		liberty monument			CE		11001110
7B		library						CE		11001110
7C		park						CE		11001110
7D		bus station					CE		11001110
7E		white house					CE		11001110
7F		-							-		-
80-8E	internal building's tiles	C0		11000000
8F		-							-		-
90		buldozered ground			02		00000011
91-9B	road						62		01100011
9C-A6	rail						52		01010011
A7-B1	electic						C2		11000011
B2		park grass					46		01000110
B3		park tree					06		00000110
B4		corrupt ground				02		00000010
B5		flooded ground				00		00000000
B6		polluted ground				00		00000000
B7-B8	road+rail					52		01010011
B9-BA	electric+road				E2		11100011
BB-BC	electric+rail				D2		11010011
BD		water						05		00000101
BE-CD	ground/water shores			06		00000110
CE-DF	unbuldozered ground			46		01000110
E0-E1	water+road					05		00000101
E2-E3	water+rail					15		00010101
E4-E5	water+electric				85		10000101
E6		fire ground					00		00000000
E7-EA	disaster ground anim		00		00000000
EB-EC	water+road copy				05		00000101	*unused
ED-FC	road/water diagonal			05		00000101	*unused
FD		-							-		-
FE		special water tile			05		00000101	*unused
FF		-							-		-

		FLAG BITS	76543210

		7bit (80) - conduct power tile
		6bit (40) - corrupteable/burnable tile
		5bit (20) - road tile
		4bit (10) -	rail tile
		3bit (08) -	consume power tile
		2bit (04) - non-destructable tiles
		1bit (02) -
		0bit (01) -

